<!DOCTYPE html>
<html>
<head>
	<title>2.1</title>
	<link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,600,700,800" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="styles.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div class="scroll-post">
	<!-- first panel -->
	<div class="panel" id="panel1">
		<div class="container">
			<iframe style="cursor:pointer" src="setup.html" width=720 height=640 frameborder=no  allowTransparency="true"></iframe>
		</div>
	</div>
	<!-- second panel -->
	<div class="panel" id="panel2">
		<div class="container">
			<div class="header">
				<h1>A box is selected at random</h1>
				<h2>Predict its contents</h2>
			</div>
			<div class="content">
				<div id="prediction"></div>
				<div class="selection">
					<div id="selection1" style="background-color:#ED254B"></div>
					<div id="selection2" style="background-color:#C7FFD4"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- third panel -->
	<div class="panel" id="panel3">
		<div class="container">
			<h3 id="default-message">Make a prediction to see results</h3>
		</div>
	</div>

</div>

<div class="status-bar">
	<div class="links">
		<div class="stage"><h3>Setup</h3><div class="circle-cue"></div></div>
		<div class="stage"><h3>Prediction</h3><div class="circle-cue"></div></div>
		<div class="stage"><h3>Results</h3><div class="circle-cue"></div></div>
	</div>
</div>

<script type="text/javascript" src=script1.js></script>
<script>

var scroll_post = document.querySelector('.scroll-post');
var panels = document.querySelector('.scroll-post').childNodes;
console.log(panels)
panel1 = document.querySelector('#panel1');
panel2 = document.querySelector('#panel2');
panel3 = document.querySelector('#panel3');
var stage = document.querySelector('.links').childNodes;
var stage1 = document.querySelector('.links').childNodes[1];
var stage2 = document.querySelector('.links').childNodes[3];
var stage3 = document.querySelector('.links').childNodes[5];

panel1.onclick=function() {
	target1 = (0*scroll_post.scrollWidth)/100;
	console.log(target);
	scroll_post.scrollTo({
	  left: target1,
	  behavior: 'smooth'
	});
	stage_1();
}

panel2.onclick=function() {
	target2 = (20*scroll_post.scrollWidth)/100;
	console.log(target);
	scroll_post.scrollTo({
	  left: target2,
	  behavior: 'smooth'
	});
	stage_2();
}

panel3.onclick=function() {
	panel3.scrollIntoView({ 
	  behavior: 'smooth',
	  block: "end",
	  inline: "end"
	});
	stage_3();
}

// setup stage
function stage_1() {
	// console.log("stage1")
	stage1.childNodes[0].style.visibility="visible";
	stage2.childNodes[0].style.visibility="hidden";
	stage3.childNodes[0].style.visibility="hidden";
	stage1.childNodes[1].style.backgroundColor="#ED574B";
	stage2.childNodes[1].style.backgroundColor="#CCCCCC";
	stage3.childNodes[1].style.backgroundColor="#CCCCCC";
	panels[3].style.transform="scale(1.1)";
	panels[7].style.transform="scale(1)";
	panels[11].style.transform="scale(1)";
}
// prediction stage
function stage_2() {
	// console.log("stage2")
	stage2.childNodes[0].style.visibility="visible";
	stage1.childNodes[0].style.visibility="hidden";
	stage3.childNodes[0].style.visibility="hidden";
	stage2.childNodes[1].style.backgroundColor="#ED574B";
	stage1.childNodes[1].style.backgroundColor="#CCCCCC";
	stage3.childNodes[1].style.backgroundColor="#CCCCCC";
	panels[3].style.transform="scale(1)";
	panels[7].style.transform="scale(1.1)";
	panels[11].style.transform="scale(1)";

}
// results stage
function stage_3() {
	// console.log("stage3")
	stage3.childNodes[0].style.visibility="visible";
	stage1.childNodes[0].style.visiblity="hidden";
	stage2.childNodes[0].style.visibility="hidden";
	stage3.childNodes[1].style.backgroundColor="#ED574B";
	stage1.childNodes[1].style.backgroundColor="#CCCCCC";
	stage2.childNodes[1].style.backgroundColor="#CCCCCC";
	panels[3].style.transform="scale(1)";
	panels[7].style.transform="scale(1)";
	panels[11].style.transform="scale(1.1)";
}

// random prediction setup
var result_ball;
var result_square;
var result_number;

function prediction() {
	body = document.querySelector('#prediction')
	box = document.createElement('wide-custom-box');
	box.setAttribute("id", "pred_box")
	body.append(box);
	lid = document.createElement('lid');
	lid.setAttribute("class","lid");
	label = document.createElement('h1');
	number = Math.floor((Math.random() * 3) + 1)
	result_number = number;
	if(number==1){
		label.innerHTML = "A";
	} else if (number==2){
		label.innerHTML = "B";
	} else if (number==3){
		label.innerHTML = "C";
	}
	target = document.querySelector('#pred_box');
	target.append(lid);
	target.append(label);
	ball = document.createElement('div');
	ball.setAttribute("class","ball");
	ball_colors = ["#ED254B", "#C7FFD4"];
	cube_colors = ["#3FA9F5", "#FBC83B"];
	ball_color = Math.floor((Math.random() * 2) + 0);
	ball.style.backgroundColor = ball_colors[ball_color];
	target.append(ball)
	cube = document.createElement('div');
	cube.setAttribute("class","cube");
	cube_color = Math.floor((Math.random() * 2) + 0);
	result_ball = ball_colors[ball_color];
	result_square = cube_colors[cube_color];
	cube.style.backgroundColor = cube_colors[cube_color];
	target.append(cube);
}

stage_1();
prediction();

scroll_post.onscroll=function() {
	var w = scroll_post.scrollWidth;
	var w_loc = scroll_post.scrollLeft;
	var loc = w_loc/w

	if(loc < .15  ){
		stage_1();
	} else if (loc > .15 & loc < .30) {
		stage_2();
	} else if( loc > .30 & loc < .6) {
		stage_3();
	}
} 

var pred_selections = document.querySelector('.selection').childNodes;
var pred_sel_section = document.querySelector('.selection');
var selections = pred_sel_section.querySelectorAll('div');
var selection1 = pred_selections[1];
var selection2 = pred_selections[3];
var selection3 = pred_selections[5];
var selection4 = pred_selections[7];
var sel_ball;
var sel_square;
console.log(pred_selections);

for(i=0;i<selections.length;i++){
	selections[i].onclick=function() {
		var parent = this.parentNode;
		var circles = [1,3]
		var squares = [5,7]
		var ref;
		// The equivalent of parent.children.indexOf(child)
		var index = Array.prototype.indexOf.call(parent.children, this);
		if(index == 0){
			ref = 1;
		} else if (index==1) {
			ref = 3;
		} else if (index == 2){
			ref = 5;
		} else if (index == 3){
			ref =7
		}
		console.log(ref);
		var node = index+1;
		var color = document.querySelector("#selection"+node).style.backgroundColor;

		if (index == 0 | index == 1) {
			sel_ball = this.id;
			circles.forEach(function(i) {
			    pred_selections[i].style.width="3em";
				pred_selections[i].style.height="3em";
				pred_selections[i].style.boxShadow="";
			});
		} else if (index == 2 | index == 3) {
			sel_square = this.id;
			squares.forEach(function(i) {
			    pred_selections[i].style.width="3em";
				pred_selections[i].style.height="3em";
				pred_selections[i].style.boxShadow="";
			});
		}
		if(sel_ball !=undefined){
			get_results();
			console.log("this is" +sel_ball + "," + sel_square)
		}

		pred_selections[ref].style.width="4em";
		pred_selections[ref].style.height="4em";
		pred_selections[ref].style.boxShadow="0.2em 0.2em 2em " + color;

	}
}


function rgbToHex(r, g, b) {
    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
}

function get_results() {
	var ball;
	var square;
	var ball_color;
	var square_color;
	// get color of selected ball
	if(sel_ball == "selection1"){
		ball = "red";
		ball_color = document.querySelector('#'+sel_ball).style.backgroundColor;
		ball_color = '#' + ball_color.substr(4, ball_color.indexOf(')') - 4).split(',').map((color) => parseInt(color).toString(16)).join('');
	} else if (sel_ball == "selection2") {
		ball = "green";
		ball_color = document.querySelector('#'+sel_ball).style.backgroundColor;
		ball_color = '#' + ball_color.substr(4, ball_color.indexOf(')') - 4).split(',').map((color) => parseInt(color).toString(16)).join('');
	}
	// if selection is made for both, give results
	if (ball != undefined){
		target = panels[11].querySelector('.container');
		target.innerHTML = "";
		var results = document.createElement('div');
		results.setAttribute("class", "results");
		var text = document.createElement('h3');
		text.innerHTML = "Your Prediction";
		var selection = document.createElement('div');
		selection.innerHTML = "<div id='ball_result' style='background-color:"+ball_color+";'></div><div id='square_result' style='background-color:"+square_color+";'></div>"
		results.appendChild(text);
		results.appendChild(selection);
		target.appendChild(results);

		// real box
		result_box = document.createElement('div');
		result_box.setAttribute('class', 'result_box')
		target.prepend(result_box);
		box = document.createElement('custom-box');
		box.setAttribute("id", "result_box")
		result_box.append(box);
		lid = document.createElement('lid');
		lid.setAttribute("class","lid");
		label = document.createElement('h1');
		number = result_number;
		if(result_number==1){
			label.innerHTML = "A";
		} else if(result_number==2){
			label.innerHTML = "B";
		} else if (result_number==3){
			label.innerHTML = "C";
		}
		box.append(lid);
		box.append(label);
		ball = document.createElement('div');
		ball.setAttribute("class","ball");
		ball.style.backgroundColor = result_ball
		box.append(ball)
		cube = document.createElement('div');
		cube.setAttribute("class","cube");
		cube.style.backgroundColor = result_square;
		box.append(cube);

		// message
		var p = document.createElement("p");
		p.setAttribute('id','result-message')
		if(result_ball.toLowerCase() == ball_color){
			p.innerHTML="Correct!"
			target.prepend(p);
		} else {
			console.log(result_ball+":"+ball_color+","+result_square+":"+square_color);
			p.innerHTML="Try Again"
			target.prepend(p);
		}

		// open results
		open_result();

	}

}

function open_result() {
	var boxes = document.querySelector("#result_box");
	    target = boxes;
	    target.style.transform="scale(0.9)";
	    target.style.width="25%";
	    target.style.boxShadow="0em 0.5em 2em #ED958E";
	    target.querySelector('.ball').style.opacity="1";
	    target.querySelector('.cube').style.opacity="1";
	    target.querySelector('.ball').style.transform="translate(-0.5em, -4em) scale(1.5) ";
	    target.querySelector('.cube').style.transform="translate(0.5em, -4em) scale(1.5) rotate(-15deg)";
	    target.querySelector('lid').style.width="80%";
	    target.querySelector('lid').style.transform="rotate(-120deg)";
}



</script>

</body>
</html>